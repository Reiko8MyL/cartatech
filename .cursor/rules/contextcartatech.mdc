---
alwaysApply: true
---

# Contexto del Proyecto CartaTech - Estado de Producci√≥n

## Estado Actual del Proyecto

**El sitio est√° en PRODUCCI√ìN y funcionando en la web.**

**√öltima actualizaci√≥n de documentaci√≥n**: Enero 2025

### Estado de Implementaci√≥n Reciente

**‚úÖ Completado (Enero 2025):**
- ‚úÖ Sistema de Perfiles Mejorado: Banners personalizados para perfiles, campos adicionales (ubicaci√≥n, razas favoritas, formato favorito, team, tienda TCG), configuraci√≥n de privacidad colapsable, vista p√∫blica integrada en perfil privado
- ‚úÖ LocationSelector Completo: Base de datos completa de pa√≠ses latinoamericanos y principales con todas sus regiones y ciudades/comunas (m√°s de 300 comunas para Chile)
- ‚úÖ Optimizaci√≥n de Im√°genes: Todos los componentes Image que usan Cloudinary tienen `unoptimized` configurado para evitar consumir transformaciones de Vercel. Sistema completo de optimizaci√≥n con Cloudinary para todas las im√°genes del proyecto.

**‚úÖ Completado (Diciembre 2024):**
- ‚úÖ SEO y Metadatos: Metadatos din√°micos implementados en todas las p√°ginas principales, Schema.org JSON-LD completo (mazos, usuarios, listas, breadcrumbs)
- ‚úÖ Paginaci√≥n: Implementada en todas las listas grandes (mazos p√∫blicos, comentarios, panel de administraci√≥n)
- ‚úÖ Analytics: Todos los eventos cr√≠ticos implementados y funcionando (crear mazo, publicar, favoritar, comentar, buscar cartas, exportar, compartir)
- ‚úÖ Code Splitting: `deck-management-panel` refactorizado (reducido de ~1826 a 691 l√≠neas, ~62% de reducci√≥n)
- ‚úÖ Sistema de Compartir: Mejorado con c√≥digos cortos, previews OG mejorados, botones de redes sociales, soporte para Web Share API
- ‚úÖ Sistema de Seguimiento (Follow): Implementado sistema completo de seguidores/seguidos con APIs, UI en perfiles y notificaciones
- ‚úÖ Mejoras en Deck Builder: Badge de total de cartas, sistema de Drag & Drop para agregar y reordenar cartas, filtros mejorados
- ‚úÖ Exportaci√≥n de Mazos Mejorada: Modal unificado con formatos Imagen (alta calidad con super-sampling 2x), Lista (Texto) y TTS Code

**‚è≥ Pendiente Alta Prioridad:**
- Filtros avanzados en mazos p√∫blicos (por formato, raza, fecha, popularidad)
- Exportaci√≥n avanzada (PDF, formatos especializados)

### Informaci√≥n de Despliegue
- **URL de Producci√≥n**: https://www.cartatech.cl/
- **Plataforma de Hosting**: Vercel
- **Estado**: Desplegado y activo
- **Repositorio GitHub**: https://github.com/Reiko8MyL/cartatech
- **Rama Principal**: `main`

### Informaci√≥n T√©cnica
- **Framework**: Next.js 16.0.7 (App Router)
- **Lenguaje**: TypeScript 5.x
- **Estilos**: Tailwind CSS 4 (@tailwindcss/postcss) + Shadcn UI + Radix UI
- **Base de Datos**: PostgreSQL con Prisma (migraci√≥n completada)
- **ORM**: Prisma 7.0.1 con adapter PostgreSQL (@prisma/adapter-pg)
- **Autenticaci√≥n**: Sistema personalizado con APIs REST (NextAuth 5.0.0-beta.30 instalado pero no implementado a√∫n)
- **React**: 19.2.1
- **Cliente API**: Funciones en `lib/api/` con soporte para `NEXT_PUBLIC_API_URL` y fallback a rutas relativas
- **Sistema de Roles**: Implementado con funciones de autorizaci√≥n (`lib/auth/authorization`)
- **Rate Limiting**: Sistema implementado en memoria (`lib/rate-limit/rate-limit`) con configuraciones por tipo de endpoint
- **Logging**: Sistema de logging estructurado (`lib/logging/logger`) para tracking de operaciones y errores
- **Analytics**: Google Analytics 4 (GA4) con `@next/third-parties` y Vercel Analytics (`@vercel/analytics`, `@vercel/speed-insights`)
- **Monetizaci√≥n**: Google AdSense implementado con sistema de anuncios en m√∫ltiples posiciones
- **Onboarding**: Sistema de tour de bienvenida (`components/onboarding/welcome-tour`) para nuevos usuarios
- **UI Components**: Radix UI primitives, Shadcn UI components, Lucide React icons, Sonner para toasts
- **Estado**: React hooks nativos (useState, useEffect, useMemo, useCallback), Context API para autenticaci√≥n
- **Gesti√≥n de Estado URL**: No se usa `nuqs` actualmente (no instalado en package.json)
- **Data Fetching**: `@tanstack/react-query` v5.90.12 para gesti√≥n de estado del servidor y cach√© (‚úÖ IMPLEMENTADO Y EN USO - QueryProvider configurado en `components/providers/query-provider.tsx`, hooks disponibles: `useCardsQuery`, `usePublicDecksQuery`, `useUserDecksQuery`, `useDeckQuery`, `useInvalidateDecks`)
- **Virtualizaci√≥n**: `@tanstack/react-virtual` v3.13.13 para renderizado eficiente de listas largas (‚úÖ IMPLEMENTADO - Componentes VirtualizedCardGrid y VirtualizedEditionGrid disponibles en `components/galeria/`, pueden usarse cuando sea necesario para listas muy largas)
- **Manejo de Errores**: React Error Boundary (`react-error-boundary`) para captura de errores en componentes
- **Drag & Drop**: Implementado con `@dnd-kit` para gesti√≥n fluida de cartas en el Deck Builder

### Estado de Migraci√≥n a Base de Datos

#### ‚úÖ Completado
- **Infraestructura**: Esquema de Prisma completo con modelos: User, Deck, DeckVersion, FavoriteDeck, DeckLike, Vote, UserCollection, Comment, Notification, Card, CardMetadata, ShareCode, DeckPanelBannerSettings, Follow
- **APIs P√∫blicas Implementadas**:
 - ‚úÖ `/api/auth/register` - Registro de usuarios con validaci√≥n de edad
 - ‚úÖ `/api/auth/login` - Inicio de sesi√≥n con bcrypt
 - ‚úÖ `/api/decks` - CRUD completo de mazos (GET con soporte para `publicOnly=true`, POST con validaci√≥n de ID duplicado)
 - ‚úÖ `/api/decks/[id]` - Operaciones individuales (GET con incremento de viewCount, PUT con validaci√≥n de permisos, DELETE)
 - ‚úÖ `/api/decks/[id]/versions` - Historial de versiones (GET)
 - ‚úÖ `/api/decks/[id]/comments` - Sistema de comentarios (GET con respuestas anidadas, POST con validaciones)
 - ‚úÖ `/api/decks/[id]/comments/[commentId]` - Editar/eliminar comentarios (PUT, DELETE)
 - ‚úÖ `/api/favorites` - Gesti√≥n de favoritos (GET, POST, DELETE)
 - ‚úÖ `/api/favorites/toggle` - Alternar favoritos
 - ‚úÖ `/api/likes` - Sistema de likes (GET con filtros)
 - ‚úÖ `/api/likes/toggle` - Alternar likes
 - ‚úÖ `/api/votes` - Sistema de votaci√≥n de comunidad (GET, POST con validaci√≥n de raza √∫nica)
 - ‚úÖ `/api/collection` - Colecci√≥n de cartas del usuario (GET, POST, PUT)
 - ‚úÖ `/api/notifications` - Sistema de notificaciones (GET con manejo de errores opcionales, PUT para marcar como le√≠das)
 - ‚úÖ `/api/users/[username]` - Perfil de usuario con estad√≠sticas (GET con agregaciones, incluye campos de perfil y configuraci√≥n de privacidad)
 - ‚úÖ `/api/users/me` - Perfil privado del usuario actual (GET, PUT con todos los campos de perfil y privacidad)
 - ‚úÖ `/api/users/[username]/follow` - Sistema de seguimiento (POST, DELETE)
 - ‚úÖ `/api/users/[username]/followers` - Lista de seguidores (GET)
 - ‚úÖ `/api/users/[username]/following` - Lista de usuarios seguidos (GET)
 - ‚úÖ `/api/users/[username]/follow-status` - Estado de seguimiento (GET)
 - ‚úÖ `/api/cards` - Obtener todas las cartas (GET con soporte para `includeAlternatives` y `format`)
 - ‚úÖ `/api/cards/[cardId]` - Obtener carta espec√≠fica (GET)
 - ‚úÖ `/api/cards/metadata` - Obtener metadata de cartas (GET)
 - ‚úÖ `/api/cards/[cardId]/metadata` - Gesti√≥n de metadata de carta (GET, PUT, DELETE)
 - ‚úÖ `/api/banner-settings` - Obtener ajustes de banners (GET p√∫blico)
 - ‚úÖ `/api/decks/[id]/share` - Gesti√≥n de c√≥digos de compartir (GET, POST)
 - ‚úÖ `/api/share/[code]` - Redirigir desde c√≥digo corto (GET)
 - ‚úÖ `/api/og/deck/[id]` - Generar imagen OG para mazos (GET)
- **APIs de Administraci√≥n Implementadas**:
 - ‚úÖ `/api/admin/stats` - Estad√≠sticas del dashboard (GET, requiere MODERATOR o ADMIN)
 - ‚úÖ `/api/admin/users` - Lista de usuarios con b√∫squeda (GET, requiere ADMIN)
 - ‚úÖ `/api/admin/users/[userId]` - Actualizar rol de usuario (PUT, requiere ADMIN)
 - ‚úÖ `/api/admin/cards` - Crear cartas en base de datos (POST, requiere ADMIN)
 - ‚úÖ `/api/admin/ban-list` - Gesti√≥n de ban list (GET, PUT, requiere ADMIN)
 - ‚úÖ `/api/admin/ban-list/batch` - Actualizaci√≥n masiva de ban list (PUT, requiere ADMIN)
 - ‚úÖ `/api/admin/comments` - Moderaci√≥n de comentarios (GET, requiere MODERATOR o ADMIN)
 - ‚úÖ `/api/admin/comments/[commentId]` - Eliminar comentarios (DELETE, requiere MODERATOR o ADMIN)
 - ‚úÖ `/api/admin/banner-settings` - Gesti√≥n de ajustes de banners (GET, PUT, DELETE, requiere ADMIN)
 - ‚úÖ `/api/admin/upload-banner-image` - Subir im√°genes de banner a Cloudinary (POST, requiere ADMIN)
- **Funcionalidades Migradas**:
 - ‚úÖ Mazos (Decks) - Con fallback a localStorage, creaci√≥n autom√°tica de versiones
 - ‚úÖ Favoritos - Con fallback a localStorage
 - ‚úÖ Likes de mazos - Con fallback a localStorage
 - ‚úÖ Vistas de mazos (viewCount) - Incremento autom√°tico al ver mazos p√∫blicos
 - ‚úÖ Votos de comunidad - Con fallback a localStorage, validaci√≥n de raza √∫nica por usuario
 - ‚úÖ Colecci√≥n de cartas - Con fallback a localStorage, sincronizaci√≥n completa
 - ‚úÖ Comentarios en mazos - Sistema completo con respuestas anidadas, validaciones robustas
 - ‚úÖ Notificaciones - Sistema de notificaciones para interacciones, manejo silencioso de errores
 - ‚úÖ Perfiles de usuario - Visualizaci√≥n de perfiles p√∫blicos con estad√≠sticas agregadas y contadores de seguimiento
 - ‚úÖ Sistema de Seguimiento - Seguir/dejar de seguir usuarios con notificaciones
 - ‚úÖ Cartas en base de datos - Sistema completo de cartas con soporte para cartas alternativas y ban list
 - ‚úÖ Metadata de cartas - Sistema para almacenar posiciones personalizadas y otros metadatos
 - ‚úÖ Panel de administraci√≥n - Dashboard completo con estad√≠sticas, gesti√≥n de usuarios, cartas y moderaci√≥n
 - ‚úÖ Sistema de compartir - C√≥digos cortos para compartir mazos con analytics de clics
 - ‚úÖ Sistema de banners - Ajustes personalizados de visualizaci√≥n de banners por contexto y dispositivo
 - ‚úÖ Open Graph Images - Generaci√≥n din√°mica de im√°genes OG para previews en redes sociales
 - ‚úÖ Perfiles Personalizados - Banners personalizados para perfiles, campos adicionales (pa√≠s, regi√≥n, ciudad, razas favoritas, formato favorito, team, tienda TCG), configuraci√≥n de privacidad por campo
 - ‚úÖ Vista P√∫blica Integrada - Vista p√∫blica del perfil accesible desde perfil privado mediante bot√≥n "Vista P√∫blico", cambios reflejados inmediatamente
- **Seguridad**: Contrase√±as hasheadas con bcrypt (12 rounds), validaciones en cliente y servidor, verificaci√≥n de permisos en todas las operaciones de escritura, sistema de roles (USER, MODERATOR, ADMIN), rate limiting en APIs cr√≠ticas, headers de seguridad en `next.config.ts` (X-Content-Type-Options, X-Frame-Options)

#### üîÑ Pendiente / Mejoras Futuras
- **Autenticaci√≥n**: NextAuth est√° instalado pero no implementado (actualmente usa sistema personalizado)
- **Componentes**: Algunos componentes a√∫n usan funciones de localStorage directamente, pero tienen fallback autom√°tico
- **Optimizaciones de Rendimiento**:
 - ‚úÖ React Query implementado y en uso (cartas, mazos p√∫blicos, mazos de usuario)
 - ‚úÖ Virtualizaci√≥n implementada (componentes VirtualizedCardGrid y VirtualizedEditionGrid disponibles)
 - ‚úÖ Lazy loading de componentes pesados (WelcomeTour, Analytics, SpeedInsights, CardsPanel, DeckManagementPanel)
 - ‚úÖ Memoizaci√≥n de c√°lculos costosos (totalCards, decksWithComputedValues)
 - ‚úÖ Paginaci√≥n implementada en listas grandes (mazos p√∫blicos, comentarios, panel de administraci√≥n)
 - ‚úÖ SEO y metadatos din√°micos implementados (metadata exports en p√°ginas, Schema.org JSON-LD para mazos, usuarios, listas y breadcrumbs)
 - ‚úÖ Eventos de Analytics implementados (todos los eventos cr√≠ticos trackeados: crear mazo, publicar, favoritar, comentar, buscar cartas, exportar, compartir)
 - ‚úÖ Code splitting completado (deck-management-panel refactorizado, reducido de ~1826 a 691 l√≠neas, ~62% de reducci√≥n)
 - ‚úÖ Sistema de compartir mejorado (c√≥digos cortos, previews OG mejorados, botones de redes sociales, Web Share API)
 - ‚úÖ Exportaci√≥n de alta calidad (super-sampling 2x para im√°genes n√≠tidas)
 - ‚è≥ Cach√© adicional de metadata de cartas con React Query - Pendiente
 - ‚úÖ Optimizaci√≥n de im√°genes con Cloudinary: Todos los componentes Image configurados con `unoptimized` para evitar transformaciones de Vercel
- ‚è≥ Optimizaci√≥n de im√°genes adicionales (blur placeholders) - Pendiente
- **Funcionalidades Adicionales**:
 - Exportaci√≥n de mazos en formatos PDF o especializados
 - B√∫squeda avanzada con filtros m√∫ltiples en comunidad
 - Historial de b√∫squedas recientes
- **Testing**:
 - Unit tests para funciones utilitarias
 - Integration tests para APIs
 - E2E tests para flujos cr√≠ticos
- **PWA**: Implementar Progressive Web App con service worker y manifest

### Arquitectura de Datos
- **Base de Datos**: PostgreSQL (Vercel Postgres recomendado)
- **ORM**: Prisma con adapter PostgreSQL
- **Fallback**: Sistema h√≠brido que usa base de datos cuando el usuario est√° autenticado, localStorage para usuarios no autenticados
- **Sesi√≥n**: Usuario guardado en localStorage solo para mantener sesi√≥n, todos los datos persistentes en base de datos
- **Modelos Principales**:
 - `User`: Usuarios con roles (USER, MODERATOR, ADMIN), campos de perfil (avatar, bio, banner, ubicaci√≥n, preferencias, configuraci√≥n de privacidad)
 - `Deck`: Mazos con versionado autom√°tico y soporte para im√°genes de fondo personalizadas
 - `Card`: Cartas del juego almacenadas en BD con soporte para alternativas
 - `CardMetadata`: Metadatos personalizados de cartas (posiciones, etc.)
 - `Comment`: Sistema de comentarios con respuestas anidadas
 - `Notification`: Sistema de notificaciones para interacciones
 - `ShareCode`: C√≥digos cortos para compartir mazos con analytics
 - `DeckPanelBannerSettings`: Ajustes de visualizaci√≥n de banners por contexto, vista y dispositivo
 - `Follow`: Modelo para sistema de seguidores entre usuarios
 - `FavoriteDeck`, `DeckLike`, `Vote`, `UserCollection`: Interacciones del usuario
- **Campos de Perfil de Usuario**:
 - `avatarCardId`, `avatarZoom`, `avatarPositionX`, `avatarPositionY`: Personalizaci√≥n de avatar
 - `bio`: Biograf√≠a del usuario
 - `profileBannerImage`: URL de imagen de fondo del banner del perfil (opacidad 70% aplicada autom√°ticamente)
 - `country`, `region`, `city`: Ubicaci√≥n del usuario (con base de datos completa de pa√≠ses latinoamericanos)
 - `favoriteRaces`: Array de razas favoritas (m√°x 3) almacenado como JSON
 - `favoriteFormat`: Formato favorito (RE, RL, LI)
 - `team`: Team al que pertenece (texto libre)
 - `preferredStore`: Tienda TCG preferida (texto libre)
 - `showLocation`, `showFavoriteRaces`, `showFavoriteFormat`, `showTeam`, `showPreferredStore`: Configuraci√≥n de privacidad (boolean, default: true)

### Consideraciones Importantes
- **Cualquier cambio en el c√≥digo se desplegar√° autom√°ticamente a producci√≥n** cuando se haga push a la rama `main` en GitHub
- **Siempre verificar que los cambios funcionen localmente** antes de hacer commit y push
- **El sitio est√° en uso real por usuarios**, por lo que los cambios deben ser cuidadosos y probados
- **Las variables de entorno de producci√≥n** est√°n configuradas en Vercel (incluyendo `DATABASE_URL`)
- **El dominio personalizado** (cartatech.cl) est√° configurado y funcionando
- **Compatibilidad**: Las funciones antiguas de localStorage siguen funcionando gracias al sistema de fallback
- **Migraci√≥n gradual**: Los componentes pueden actualizarse uno por uno sin romper funcionalidad

### Flujo de Trabajo

**Desarrollo Local:**
1. Instalar dependencias: `npm install`
2. Configurar variables de entorno en `.env.local` (copiar de `.env.example` si existe)
3. Generar cliente de Prisma: `npx prisma generate`
4. Sincronizar schema con BD (desarrollo): `npx prisma db push`
5. Ejecutar servidor de desarrollo: `npm run dev`
6. Abrir Prisma Studio (opcional): `npm run db:studio`

**Despliegue a Producci√≥n:**
1. Desarrollo local ‚Üí Pruebas locales ‚Üí `npm run build` para verificar errores
2. Commit ‚Üí Push a GitHub (rama `main`)
3. Despliegue autom√°tico en Vercel (1-3 minutos)
4. Live en https://www.cartatech.cl/

**Comandos Importantes:**
- `npm run dev`: Servidor de desarrollo
- `npm run build`: Build de producci√≥n (verificar antes de deploy)
- `npm run start`: Servidor de producci√≥n (local)
- `npm run lint`: Ejecutar ESLint
- `npm run analyze`: Bundle analyzer (requiere `ANALYZE=true`)
- `npx prisma generate`: Generar cliente de Prisma despu√©s de cambios en schema
- `npx prisma db push`: Sincronizar schema con BD (solo desarrollo, usar migraciones en producci√≥n)
- `npx prisma migrate dev`: Crear migraci√≥n en desarrollo
- `npx prisma migrate deploy`: Aplicar migraciones en producci√≥n

### Recordatorios
- Nunca romper funcionalidades existentes que los usuarios est√°n usando
- Probar cambios localmente con `npm run build` antes de subir
- Considerar el impacto en SEO y rendimiento
- Mantener la compatibilidad con dispositivos m√≥viles y tablets
- Verificar que las variables de entorno est√©n configuradas (especialmente `DATABASE_URL`)
- Las nuevas funciones deben incluir fallback a localStorage para usuarios no autenticados
- Las notificaciones y comentarios deben manejar errores silenciosamente (no romper UX)
- Validar permisos en todas las operaciones de escritura (PUT, DELETE, POST)
- Validar roles en todas las APIs de administraci√≥n antes de proceder
- Incluir detalles de errores solo en desarrollo (`NODE_ENV === "development"`)
- Usar timestamps (n√∫meros) en lugar de objetos Date en las respuestas API
- Las APIs de administraci√≥n requieren verificaci√≥n de rol expl√≠cita usando `hasAdminAccess` o `hasModeratorAccess`
- El sistema de cartas soporta cartas alternativas mediante `baseCardId` y `isCosmetic`
- Las cartas tienen ban list por formato (RE, RL, LI) con valores 0-3 (0=BAN, 1=Max 1, 2=Max 2, 3=Libre)
- El sistema de compartir genera c√≥digos cortos √∫nicos de 6 caracteres para mazos p√∫blicos
- Los c√≥digos de compartir tienen contador de clics y soporte para expiraci√≥n opcional
- El sistema de banners permite ajustes personalizados por contexto (mis-mazos, mazos-comunidad, favoritos, deck-builder, mazo-individual), modo de vista (grid, list) y dispositivo (desktop, tablet, mobile)
- Las im√°genes de banner se almacenan en Cloudinary con upload preset configurado
- Las im√°genes OG se generan din√°micamente como SVG con informaci√≥n del mazo para previews en redes sociales
- **Optimizaci√≥n de Im√°genes Vercel**: Para evitar exceder el l√≠mite gratuito de transformaciones de Vercel (5,000/mes), todas las im√°genes de Cloudinary usan `unoptimized={true}` o `unoptimized={isCloudinaryOptimized}`. Esto evita que Vercel procese im√°genes que ya est√°n optimizadas por Cloudinary.
- **Sistema de Perfiles Personalizados**: 
  - Banners personalizados con opacidad 70% aplicada autom√°ticamente
  - Vista p√∫blica accesible desde perfil privado mediante bot√≥n "Vista P√∫blico" (modal), no accesible directamente desde `/perfil/[username]`
  - Informaci√≥n adicional en Card separado (fuera del header del banner)
  - Configuraci√≥n de privacidad colapsable (componente `PrivacySettings` con `Collapsible` de Radix UI)
  - Base de datos completa de ubicaciones en `lib/data/locations.ts` (pa√≠ses latinoamericanos y principales con todas sus regiones y ciudades/comunas)
  - Componentes: `PublicProfileView`, `ProfileBannerSelector`, `LocationSelector`, `FavoriteRacesSelector`, `FavoriteFormatSelector`, `PrivacySettings`
  - Campos de privacidad: `showLocation`, `showFavoriteRaces`, `showFavoriteFormat`, `showTeam`, `showPreferredStore` (default: true)
  - La vista p√∫blica respeta las preferencias de privacidad del usuario
  - Avatar agrandado 20% (168px) en perfiles
  - Panel principal sin contornos (border removido)

### Sistema de Rate Limiting
- Sistema implementado en `lib/rate-limit/rate-limit.ts` con almacenamiento en memoria
- Configuraciones por tipo de endpoint:
 - **Autenticaci√≥n**: 5 requests / 15 minutos (m√°s restrictivo)
 - **Escritura** (POST, PUT, DELETE): 30 requests / 1 minuto
 - **Lectura** (GET): 100 requests / 1 minuto
 - **Administraci√≥n**: 50 requests / 1 minuto
 - **Default**: 60 requests / 1 minuto
- Retorna c√≥digo 429 (Too Many Requests) cuando se excede el l√≠mite
- Headers de respuesta: `X-RateLimit-Remaining`, `X-RateLimit-Reset`, `Retry-After`
- Identificaci√≥n por IP o userId (si est√° disponible en headers)
- En desarrollo, puede deshabilitarse con `DISABLE_RATE_LIMIT=true`
- **Nota**: Para producci√≥n a escala, considerar migrar a Redis o @upstash/ratelimit

### Sistema de Logging
- Sistema estructurado en `lib/logging/logger` para tracking de operaciones
- Logs de errores con contexto detallado en desarrollo
- Tracking de tiempo de ejecuci√≥n en APIs cr√≠ticas
- Logging de rate limit exceeded para an√°lisis de seguridad

### Sistema de Analytics y Monitoreo
- **Google Analytics 4 (GA4)**: Implementado con `@next/third-parties/google`
 - Variable de entorno: `NEXT_PUBLIC_GA_ID` (formato: `G-XXXXXXXXXX`)
 - Tracking autom√°tico de pageviews mediante `GoogleAnalyticsProvider`
 - Eventos personalizados disponibles en `lib/analytics/events`
- **Vercel Analytics**: Implementado con `@vercel/analytics` y `@vercel/speed-insights`
 - Analytics de visitas, p√°ginas m√°s visitadas, referrers
 - Speed Insights para m√©tricas de rendimiento (LCP, FID, CLS, FCP, TTFB)

### Sistema de Monetizaci√≥n (Google AdSense)
- Implementado con sistema de anuncios en m√∫ltiples posiciones
- Variable de entorno: `NEXT_PUBLIC_ADSENSE_ID` (formato: `ca-pub-XXXXXXXXXXXXXXXX`)
- Posiciones disponibles:
 - **Top Banner**: Banner superior (728x90px desktop, 320x50px m√≥vil) - Actualmente desactivado temporalmente
 - **Sidebar**: Lateral derecho fijo (300px) - Solo desktop, solo en `/mazos-comunidad`
 - **Inline**: Entre contenido (cada 6 mazos en listados) - Solo en `/mazos-comunidad` vista grid
 - **Footer**: Pie de p√°gina (728x90px)
- Componentes: `AdBanner`, `AdContainer`, `AdSidebar`, `AdInline`, `AdSenseScript`
- Manejo silencioso de errores cuando hay bloqueadores de anuncios
- Meta tag de verificaci√≥n autom√°tico en `app/layout.tsx`

### Sistema de Onboarding
- Tour de bienvenida implementado en `components/onboarding/welcome-tour`
- Diferentes tours para visitantes no registrados y usuarios registrados
- Gu√≠a interactiva con pasos personalizados por funcionalidad
- Persistencia de estado (no mostrar nuevamente si el usuario ya lo vio)
- Tours personalizados con fondos de banners seg√∫n la raza de las cartas

### Configuraci√≥n de Next.js
- **Optimizaci√≥n de im√°genes**: 
 - Soporte para Cloudinary (`res.cloudinary.com`)
 - Formatos: WebP y AVIF
 - Cach√© m√≠nimo de 1 hora (3600 segundos)
 - **IMPORTANTE**: Todas las im√°genes que usan Cloudinary deben tener `unoptimized={true}` o `unoptimized={isCloudinaryOptimized}` para evitar consumir transformaciones de Vercel (l√≠mite gratuito: 5,000/mes)
 - Utilidades disponibles en `lib/deck-builder/cloudinary-utils.ts`: `optimizeCloudinaryUrl()`, `isCloudinaryOptimized()`, `getOptimizedImageProps()`
 - Todos los componentes Image del proyecto est√°n configurados correctamente con `unoptimized` cuando usan URLs de Cloudinary
- **Headers de seguridad**:
 - `X-Content-Type-Options: nosniff`
 - `X-Frame-Options: SAMEORIGIN`
 - `Cache-Control` personalizado por tipo de recurso
- **Bundle Analyzer**: Disponible con `ANALYZE=true npm run build`

### Variables de Entorno
**Requeridas:**
- `DATABASE_URL`: URL de conexi√≥n a PostgreSQL (requerida para producci√≥n)

**Opcionales (con valores por defecto):**
- `NEXT_PUBLIC_SITE_URL`: URL base del sitio (default: `https://www.cartatech.cl`)
- `NEXT_PUBLIC_API_URL`: URL base para APIs externas (opcional, fallback a rutas relativas `/api/...`)
- `NEXT_PUBLIC_GA_ID`: ID de Google Analytics 4 (formato: `G-XXXXXXXXXX`, opcional)
- `NEXT_PUBLIC_ADSENSE_ID`: ID de Google AdSense (formato: `ca-pub-XXXXXXXXXXXXXXXX`, opcional)
- `DISABLE_RATE_LIMIT`: Deshabilitar rate limiting en desarrollo (opcional, `true` para deshabilitar)

**Cloudinary (para subida de im√°genes de banner):**
- Variables configuradas en Vercel para producci√≥n
- Requeridas para `/api/admin/upload-banner-image`: `CLOUDINARY_CLOUD_NAME`, `CLOUDINARY_API_KEY`, `CLOUDINARY_API_SECRET`, `CLOUDINARY_UPLOAD_PRESET`

**Nota:** Todas las variables `NEXT_PUBLIC_*` son accesibles en el cliente. Las dem√°s son solo del servidor.

---

## üéØ Pr√≥ximos Pasos Recomendados

### Prioridad Alta (Impacto Inmediato)

1. **Filtros Avanzados en Comunidad**
 - Implementar filtros por formato (RE, RL, LI)
 - Filtros por raza, fecha de creaci√≥n, popularidad
 - Combinaci√≥n de m√∫ltiples filtros
 - **Impacto**: Mejor descubrimiento de contenido y UX

2. **Mejoras en Deck Builder (Fase 2)**
 - Exportaci√≥n avanzada (PDF, formatos especializados)
 - Historial de cambios m√°s granular
 - **Impacto**: Mejor UX en la funcionalidad principal

### Prioridad Media (Mejoras Incrementales)

3. **Migrar M√°s Componentes a React Query**
 - Migrar metadata de cartas a React Query con cach√©
 - Migrar favoritos y likes a React Query para sincronizaci√≥n autom√°tica
 - **Impacto**: Mejor sincronizaci√≥n de estado y menos requests innecesarios

4. **Sistema de B√∫squeda Global**
 - B√∫squeda unificada en mazos, cartas y usuarios
 - Autocompletado inteligente
 - Historial de b√∫squedas recientes
 - **Impacto**: Facilita descubrimiento de contenido

### Prioridad Baja (Funcionalidades Avanzadas)

7. **PWA (Progressive Web App)**
 - Crear `manifest.json` y service worker
 - Implementar cach√© offline para cartas
 - **Impacto**: Experiencia tipo app nativa, funciona offline

8. **Sistema de Seguimiento (Fase 2)**
 - Feed de actividad de usuarios seguidos en el Dashboard
 - Recomendaciones basadas en usuarios seguidos
 - **Impacto**: Mayor engagement y comunidad

9. **Testing**
 - Unit tests para funciones utilitarias
 - Integration tests para APIs principales
 - E2E tests para flujos cr√≠ticos (crear mazo, publicar)
 - **Impacto**: Mayor confiabilidad y menos bugs en producci√≥n

### Optimizaciones T√©cnicas Pendientes

- **Optimizaci√≥n de Im√°genes**: Agregar blur placeholders y `sizes` attribute m√°s preciso
- **Service Worker**: Implementar cach√© offline con Workbox
- **Rate Limiting**: Considerar migrar a Redis/@upstash/ratelimit para producci√≥n a escala (actualmente en memoria)
- **Virtualizaci√≥n**: Activar componentes virtualizados en galer√≠a si el rendimiento lo requiere

### Documentaci√≥n de Referencia
- Ver `MEJORAS_PENDIENTES.md` para plan detallado de mejoras
- Ver `OPTIMIZACIONES_ADICIONALES.md` para optimizaciones de rendimiento
- Ver `PLAN_MEJORAS.md` para roadmap completo

### M√©tricas de √âxito
Monitorear despu√©s de cada mejora:
- **Performance**: Lighthouse Score > 90, LCP < 2.5s, FID < 100ms, CLS < 0.1
- **SEO**: Mejora en rankings, aumento de tr√°fico org√°nico
- **UX**: Tasa de rebote < 50%, tiempo en sitio > 2 minutos
- **Analytics**: Todos los eventos cr√≠ticos trackeados
